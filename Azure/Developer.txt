
Serviços:

    Azure Cloud Shell
        Serviço para abrir um o PowerShell na Azure
        OBS: Também há a opção de abrir um bash

    VM (IaaS)
        No Azure, uma VM é efetivamente um servidor, sendo Windows ou Linux
        Tamanho Default: DS1
        
        Premium SSD é o armazenamento padrão para a criação de uma VM
            4Test: Caso eu queria aumentar o número de operações em menos tempo, eu devo aumentar o tamanho do disco

        Bastion
            É um serviço que permite conectar à uma máquina sem uma porta RDP aberta.    

        ARM (Azure Resource Manager)
            Modelo subjacente de como os recursos são gerenciados no Azure
            É a API que o Portal do Azure consome para manipular os serviços
            Fornece a possibilidade de criar os recursos através de código (JSON)
            Há a possibilidade de salvar Modelos da VM

    Azure App Service (PaaS)
        
        WebApp
            Não é serveless embora não tenhamos que mexer na configuração do servidor
            Tamanho Default: S1
            Há a possibilidade de implantar aplicativos com várias tecnologias diferentes
            Há a possibilidade de integrar com Github, Visual Studio (É possível construir um WebApp pelo VS, também é possível enviar e publicar), etc...
            Há a possibilidade do Web App ser uma implantação de código ou aplicativo Web em contâiner
            
            Helps
                get-command *AzWebApp* (Retorna todos os commandos de um WebApp, útil para o exame quando não souber um comando específico)
                az webapp up --location eastus --name newapp --html (Comando para criar um WebApp no Bash sem precisar criar passo a passo seja pelo terminal, bash ou Azure)

            No tamanho Basic(B1 - B3), há o escalonamento, porém manual. Já do padrão(P1V2) em diante, há o escalonamento automático
        
            WebJobs
                Serviço para executar uma aplicação específica para um WebApp em background.
                    Ex: Serviço de Mensageria que roda a cada 5 minutos
                    OBS: É vinculado a um WebApp

            Deployment Slots
                É possível criar slots de uma aplicação dentro de um WebApp.
                    Ex: Slot de Produção, contendo 100% do tráfego
                        Slot de teste, contendo 0% do tráfego
                
                É possível trocar o código de um slot com o outro
                    Ex: Após publicar as alterações numa aplicação no slot de Staging(teste), e ser validado pelo cliente
                        Não é necessário reimplementar o código no ambiente de produção, basta usar o Swap e transferir as alterações entre os slots
                        Sendo assim, o slot de staging ficará com o código de produção, e o slot de produção ficará com o código de staging.

            Diagnostic Logs
                É possível habilitar logs para o WebApp, Servidor, Erros na aplicação como por ex Exceções, tracking de requisições com falhas
    
    Containers
        
        Kubernets Service 
            Não é tão fácil utilizar mas se você tiver dinheiro, treinamento e pessoas vale a pena
        
        WebApp 
            É possível criar um WebApp baseado num container Docker
        
        Container Instances
            Maneira mais rápida e simples de executar um contâiner no Azure.
            Desvantagem: Não há escalonamento nos contâineres

        ACR (Azure Container Registry)
            Funciona como um Docker Hub, porém é um pouco melhor se levarmos em consideração a documentação, marcação, etc...
    
    Function App

        É o serviço para construir funções serveless, como as Lambdas da AWS.
        É possível construir funções em diversas linguagens e em diversos editores de texto, até mesmo na plataforma do Azure
        É possível construir funções de triggers, etc...
        
        Triggers and Binding

            É possível adicionar uma trigger em diversos cenários, entre eles:
                - Ao receber uma mensagem numa fila
                - Ao receber uma requisição HTTP
                - Ao configurar um temporizador
            
        Testing Functions
            É possível testar as Function App no Azure
        
        Function App Settings
            Criar slots de Function App (dev, homolog, produção), integrado com plataformas como por ex Github, Azure Repos, BitBucket, Local Git
            Expor o HTTP Trigger Functions para a Web através do API Management
            Configurar CORS
        
        Azure Functions
            Serveless
            Simples
            Stateless
                Uma aplicação ou processo stateless são recursos isolados. 
                Nenhuma referência ou informação sobre transações antigas são armazenadas, 
                e cada uma delas é feita do zero.
                 As aplicações stateless fornecem uma função ou serviço e usam a rede de entrega de conteúdo (CDN), 
                 a web ou servidores de impressão para processar essas solicitações a curto prazo. 
            Executada através de um gatilho, seja ele um tempo pré-definido, http request, blob event, ou mensagem na fila
            Melhor design para trabalhar de forma assíncrona com outros códigos (integrando com API's)
            Tempo limite de 30 minutos
        
        Durable Functions
            Para criar funções duráveis, é necessário configurar em Development Tools > App Service Editor
            É possível configurar uma function pelo CloudShell rodando localmente antes de publicar, seja ela Durável ou não.
            Para publicar a função: 
                func azure functionapp publish "name of the function"
                "azure", é o contexto em que a função pertence. Para ver as opções, basta digitar func
            
            Stateful
                As aplicações e os processos stateful são aqueles que podem ser usados mais
                 de uma vez, como e-mails e serviços bancários online. 
                 Eles são executados com base no contexto das transações anteriores. 
                 Dependendo do que aconteceu nelas, isso pode afetar as transações atuais. 
                 Por isso, as aplicações stateful usam os mesmos servidores sempre que processam uma solicitação do usuário. 
            
            Could be long-running 
                Suporta longa duração
            
            Or a multi-step process 
                Pode chamar uma série de tarefas e sempre lembrará dos valores de variáveis que está lidando
            
            Can "suspend" while waiting for a long-running API to return - checkpoints. 
                Pode ser suspensa até o retorno de uma task por exemplo
            
            Supports complex design patterns
            Functions can call other functions - chaining
            
            Made up of a cliente, orchestrator and activities
                Client - The original triggered function
                Orchestrator - The traffic cop (Ordena as tasks da function)
                Activity - basic unit of work of a function (Se você precisa criar um arquivo, chamar uma API, realizar alguma tarefa).


            Patterns:
                Function Chaining Pattern (Encadeamento de funções) - Stateful (Durable Function)
                    Uma função que executa uma tarefa e em seguida chama outra função para dar continuidade a mesma tarefa.            

                Fan out / Fan in Pattern
                    Uma função chama algumas instâncias de uma outra função na sequência, ao terminar as instâncias, são enviados para uma outra função na sequência.
                
                Asynchronous API Pattern
                    Você pode chamar uma API e esperar o resultado para ser retornado
                
                Monitor Pattern
                    Funciona como a função original, onde tem gatilhos.
                    A diferença é que tem a função esperando que algo aconteça, porém sem saber o tempo que vai levar.
                    Ao terminar, continua o seu trabalho ou faz outras coisas, sem disparar gatilhos de tempo por exemplo, onde não saberá se será compatível
                
                Human Interaction Pattern
                    Quando há etapas humanas, sendo uma delas a aprovação. Após a interação humana, segue as demais funções


         Custom Handlers
            Permite fornecer um programa de forma eficaz que lida com o código, e isso nos permite lidar com ambas (FunctionApp com Node e .NET por exemplo)
            Permite lidar com as linguagens que não são atualmente suportadas (PHP, Ruby, Etc...)
            É um pouco mais complexo para configurar uma função, deve ser criada no vs code por exemplo e depois configurar o host.json para apontar para o executável
                Exemplo: https://docs.microsoft.com/pt-br/azure/azure-functions/create-first-function-vs-code-other?tabs=go%2Cwindows

    Azure Storage Accounts

        Understanding Storage Accounts
            
            Blob Storage
                O armazenamento não gerenciado ou um armazenamento de blobs é basicamente uma opção 
                de contâiner para você armazenar arquivos.

                Standard
                    O valor é cobrado pelo armazenamento e pelo número de solicitações por mês
                    Ponto positivo: Permite que armazene os arquivos em backups em todo o mundo

                Premium
                    O custo é quase 10x mais para armazená-lo comparado ao Standard. 
                        Contudo, vale mais a pena se os arquivos forem acessados milhares de vezes por segundo
                    O tempo de latência é menor
                    Ponto negativo: A capacidade de duplicar os arquivos globalmente é reduzida

                Redundancy
                    LRS (Locally-redundant storage) e ZRS (Zone-redundant storage)
                        Mantém 3 cópias dos arquivos
                        ZRS = Mantém as cópias em cada data center em uma região

                    GRS (Geo-redundant storage)
                        Mantém 6 cópias 
                            3 delas numa região local 
                            3 em outra região

                    GZRS(Geo-zone-redundant storage)
                        Mantém 6 cópias
                            3 delas armazenadas na zona de forma redundante localmente
                            3 em outra região mas não de forma tão redundante                    

                    Ao marcar a flag "Make read access to data avaliable in the event of regional unavailability"
                        É disponibilizado uma URL para fazer somente leitura dos arquivos.
                        Sendo assim, você pode usar para ler aquivos do local globalmente redundante.
                        Contudo, para ler e persistir, deverá usar a outra URL.

                Access Tier
                    Hot: Dados acessados frequentemente no dia a dia 
                    Cool: Acesso infrequente aos dados e cenários de backups 
                    Archive: 90% mais barata entre a camada Hot e Cool. Leva várias horas para acessar aos arquivos.

            Storage Account Settings

                Require secure transfer for REST API operations:
                    Transferência de arquivos por HTTPs, faz sentido manter ativado.
                
                Enable blob public access:
                    Significa que você pode designar contâineres ou arquivos individuais como não exigindo segurança para acessar.
                    Faz sentido manter ativado se você usar para arquivos públicos, como downloads semelhantes para cursos ou para um site público

                Enable storage account key access:
                    Ao criar, o Azure fornece duas chaves públicas que você pode usar para acessar a conta.
                        e você precisa monitorar e manter essas chaves porque elas são basicamente direitos de administrador completos sobre conteúdo da conta.

                Default to Azure Active Directory authorization in the Azure portal:
                    Autorização pelo portal do Azure.

                Data Lake Storage Gen2 (Armazenamento de vazamento de dados)
                    Normalmente utilizado na análise de big data
                    Se você precisar de um petabytes ou exabytes de dados para serem armazenados, essa é a opção.
                    Altera o sistema de arquivos e, portanto, usa um namespace hierárquico com pastas completas verdadeiras e com listas de controle de acesso em nível de arquivo
                    
                Blob Storage
                    Se você precisar de acesso FTP ou NFS v3, deverá usar o Data Lake Storage Gen2.
                
                Azure Files
                    Enable large files shares
                        É possível ter até 100 terabytes em formato de armazenamento de arquivos
                    
            Storage Account Networking and Data Protection
                
                Network access
                    
                    Public access from all networks
                        Acesso público, seja de on-promises, internet, etc...
                        Não Significa que o acesso é inseguro. Significa apenas que há uma porta trancada, e se vocÊ tiver a chave, poderá acessar o conteúdo da conta de armazenamento.
                    
                    Public access from selected virtual networks and IP address
                        Restringir o acesso à sua conta de armazenamento a determinadas redes no Azure.
                        O que isso faz é desabilitar o acesso público da internet
                    
                    Private access
                        Desabilita todo o acesso e usa o endpoint privado
                        Conexão ponto a ponto muito explícita, em vez de abri-la para uma rede virtual inteira, uma sub-rede da qual você também deve ter controle.
                        Opção ideal para acesso específico de um aplicativo ou conta de armazenamento

                Network Routing

                    Microsoft network routing
                        Não é gratuito
                        Utiliza a rede privada da Microsoft na maior parte do tempo ao trafegar dados
                        Ex: Um usuário que está loalizado nos EUA está consumindo dados de um datacenter que está no Japão,
                            esses dados será transportado pela rede da Microsoft até chegar lá, minimizando a quantidade de tempo gasto na rede pública

                    Internet routing
                        Utiliza a rede pública para trafegar os dados
                        Maior latência comparada ao tráfego na rede privada da Microsoft
                        Ex: O usuário se conecta a rede do Japão e em seguida acessa a conta de armazenamento da Microsoft de lá.

                Data Protection

                    Recovery 
                    
                        Enable soft delete for blobs/containers/file shares
                            Significa quando você exclui um arquivo/container/arquivo compartilhado mas ele não é realmente excluído e depois dos dias configurados no campo, será realmente excluído.
                            Evita exclusões acidentais ou até mesmo maliciosas
                        
                        Point-in-time restore for containers
                            É possível fazer uma restauração pontual. ("Voltar no tempo")
                            Ex: Você tem a conta de armazenamento atualizada e deseja voltar para a conta de armazenamento de 24 horas atrás

                    Tracking

                        Versioning for blobs
                            Versiona o arquivo, mesmo que seja atualizado, nunca será realmente substituído, como os arquivos do S3 na amazon.
                            Pontos positivos 
                                Caso alguma alteração do arquivo não tenha sido com sucesso, é só voltar para a versão anterior.
                                Caso tenha excluído algum arquivo de forma acidental
                            Pontos negativos
                                Usa o espaço de armazenamento adicional para manter os arquivos versionados

                        Change Feed
                            Uma forma de receber notificações.
                            Basicamente um fluxo de alterações no seu blob
                            Caso queira rastrear, enviar notificações, ver o que houve, que data, que horas, etc...
                             
                    Access Control

                        Immutability
                            Impossibilita qualquer exclusão ou alteração dos arquivos inseridos
                            Casos de uso: Manter backups imutáveis.

                Storage Account Encryption
                    
                    Encryption
                        Os arquivos do Azure são sempre criptografados. Caso alguém consiga um disco físico da Microsoft, será impossível de recuperar os dados sem a criptografia.
                        Contudo, você deve escolher quem irá gerenciar essa criptografia, se é você ou a Microsoft.

                        Microsoft-Managed Keys (MMK)
                            A Microsoft irá gerenciar as chaves para criptografia

                        Customer-Managed Keys (CMK)
                            Terá que ter uma conta de cofre de chaves e configurá-la para ter um usuário que possa ter as permissões corretas, etc...
                        
                        Enable support for Customer-Managed Keys
                            Há as opções de gerenciar chaves somente de blobs e arquivos ou todos os tipos de serviços (blobs, files, tables and queues)

                        Enable Infrastructure Encryption
                            A criptografia de infraestrutura é, na verdade, uma segunda camada de criptografia entre o serviço da Azure e o disco físico.
                            Ao habilitar, você terá um segundo conjunto de chaves manipulando na camada de infraestrutura além do conjunto que manipula os serviços

                    Tags
                        Os mesmos metadados antigos que você pode adicionar a uma conta específica.
                        ex: É possível utilizar a tag Create By e selecionar um valor para todos os recursos
                    
                Upload Files to a Storage Account
                    
                    É possível fazer upload diretamente pelo site do Azure
                    Existe o Storage Browser e Storage Explorer para navegar nos arquivos, containers, filas e tabelas.
                    O ideal é fazer upload via SDK e não via portal. Contudo, há a interface para isso.
                
                Access Keys and SAS Tokens

                    É possível atualizar e compartilhar access keys. 
                        Contudo, o método mais seguro é definir SAS, onde será compartilhado 3 opções para consumir o arquivo. 
                            (1° Blob SAS Token / 2° Blob SAS URL / 3° Blob Service SAS URL)
                        Essas configurações terão permissões totalmente configuradas, como por exemplo: Data de expiração, Leitura, Escrita, IP, Etc...

                AzCopy V10

                    Utilizado para fazer cópias arquivos no Azure
                    Funciona entre contas de armazenamento blobs, pois a URL é totalmente específica ou até mesmo entre assinaturas
                    Pode funcionar com as credenciais do Azure Active Directory para armazenamento de blobs.
                    Pode funcionar com SAS Token
                    Vantagens:
                        Os arquivos são copiados diretamente na nuvem, ao invés de baixarmos e depois fazermos upload para outro contâiner por exemplo.
                    Ex:
                        Shell para copiar arquivo blob de um contâiner para o outro
                        azcopy copy 'https://<source-storage-account-name>.blob.core.windows.net/<container-name>/<blob-path><SAS-token>' 'https://<destination-storage-account-name>.blob.core.windows.net/<container-name>/<blob-path>'

                StartCopyFromUri Method
                    Forma de copiar os arquivos usando o AzCopy pelo Visual Studio com .NET.
                    Para configurar um arquivo blob, é declarado uma variável que recebe o retorno da instância BlockBlobCliente.
                    Após isso, basta chamar o arquivo que quer receber a cópia com o método StartCopyFromUri passando o arquivo blob de origem como parâmetro.

                SetMetadata Method
                    Forma de buscar as propriedades de um arquivo blob pelo Visual Studio
                    Basta utilizar o método GetProperties na referência do objeto que contém o retorno da instância de um BlockBlobCliente.


                Storage Account Backup, Replication and Lifecycle

                    Backups (Data management > Data Protection)
                        É possível configurar e definir a frequência e quando fazer backups
                        Backup vault: Backup
                        Backup policy: Quantos dias os arquivos do backup serão mantidos 
                    
                    Object Replication
                        A Microsoft Azure cuida de manter três cópias de seus arquivos localmente e retonrará o armazenamento
                            em seis cópias de seus arquivos em armazenamento global ou georedundante.
                            Contudo, você pode configurar sua própria replicação com base em suas próprias regras
                         
                         Se você quiser ter uma conta de armazenamento de backup, talvez até em outra assinatura ou em outro lugar,
                            você pode configurar essa cópia da fonte de destino e quais arquivos estão sendo copiados

                        É possível criar as próprias configurações e regras de replicação

                    
                    Lifecycle
                        É a configuração para mover arquivos de camada hot para camada cold. 
                            Como na AWS onde você configura quantos dias um arquivo pode não ser acessado dentro de uma camada.
                            Caso ultrapasse a data x, o arquivo é movido para outra camada logicamente mais barata.
                        
                        É possível configurar e aplicar em todos os arquivos blobs ou específicos baseado em filtros
                        É possível selecionar o tipo de blob e também o subtipo.

    CosmosDB
    
        Introduction to CosmosDB
            Embora suporte tabelas e colunas, é ideal para persirtir dados que não tem o padrão sql.
            Uma vez que definido o tipo de dados, não será possível editar. 
                Ou seja, caso seja definido que o Azure CosmosDB x é um DB API for MongoDB, não poderá ser alterado para Cassandra.
            
            Tipos:
                - Core (SQL) - Recommended
                    É um banco de dados semelhante ao SQL e era chamado anteriormente de Document DB.
                    São documentos em JSON armazenados no Cosmos DB e pode ser utilizado uma sintaxe SQL para consultá-los. 
                    O nome da conta é regional, então deve ser único.
                    
                    Global Distribution
                        Geo-Redundancy
                            Cria uma instância igual na mesma região, porém em outra zona.
                            O custo será duplicado
                            ex: Crio um banco de dados para a região Oeste dos EUA.
                                Ao habilitar, será criado um banco de dados no leste dos EUA.
                        
                        Multi-region Writes
                            Dá a capacidade de gravar no banco criado os dados de todos os outros bancos de dados geograficamente distrubuídos.
                            O custo será duplicado

                    Global Replication Options
                        É possível replicar o banco de dados na opção Replicate data globally na aba Settings com apenas um clique na localização desejada no mapa
                        Para cada banco de dados há chaves para leitura e escrita e somente leitura

                    Partion Key
                        ...
                    
                    Escalonamento automático
                        É possível aumentar ou diminuir o processamento da máquina de acordo com o uso dela

                    Default Consistency

                        STRONG
                            É basicamente garantido que quando uma região gravar um dado, todas as outras também gravarão de forma consistente.
                            Contudo, pode haver um dalay.

                        BUNDED STALENESS                            
                            Os dados serão consistentes, porém, não serão persistidos ao mesmo tempo
                            É possível definir um tempo mínimo e máximo para a persistência nos bancos
                        
                        SESSION
                            A consistência será de acordo com a sessão do usuário 
                            Os usuários que estivem na mesma sessão, terão acesso aos dados ao mesmo tempo. 
                                Porém, os que estiverem em outra sessão, não.
                        
                            O mesmo client, aplicativo, poderia acessar os dados em três regiões diferentes e teriam os mesmos resultados
                            Contudo, um client diferente pode obter um pouco de um resultado anterior

                        CONSISTENT PREFIX
                            Tudo será exibido na ordem correta. Porém, há uma defasagem definida entre a hora em que é escrito nas regiões.
                            Contudo, é garantido que os dados serão escritos na forma correta.
                        
                        EVENTUAL
                            Não há garantia que os dados estão sendo persistidos na ordem correta
                            Ex: Retweetsm, curtidas e comentários que não são segmentados.
                            
                    Change Feed Notifications

                        É possível criar Azure Functions para notificar sempre que houver uma alteração nos arquivos.
                            Há o gatilho "Azure Cosmos DB Trigger" na Azure Function.

                        Leases:
                            Garante que a função é a única que poderá alterar algo relacionado ao arquivo informado.
                                                                        

                - Cosmos DB API for MongoDB
                    Banco de dados totalmente gerenciado para app's que consomem bancos MongoDB.
                        Recomendado para migração de um banco local MongoDB para a Azure.
                
                - Cassandra
                    Banco de dados totalmente gerenciado para app's que conomem bancos Apache Cassandra.
                        Recomendado para migração de um banco local Apache Cassandra para a Azure.

                - Azure tables
                    Banco de dados totalmente gerenciado para app's escritos para armazenamento em Azure Table
                        Recomendado para migrar banco de dados relacionais
                
                Gremlin (Graph)
                    Banco de dados que lida com nós e arestas, relações entre as coisas.
                        Recomendado para uso de dados que contém muitos relacionamentos.
                        Ex: Pessoas, lugares, profissões, etc...
                
    Azure Authentication

        Azure AD(Active Directory)
            Serviço central que lida com identidade e autenticação na nuvem
            É diferente de Windows Active Directory, que gerencia todos os usuários, grupos e dispositivos no ambiente corporativo.
            É possível criar uma conta para um usuário a fim de que ele sempre se autentique por ela e também criar através de redes sociais por exemplo.

        Azure AD Connect
            Utilziado para sincronizar um servidor AD local com o Azure AD.

        Azure AD Tenant
            Os usuários devem pertencer ao menos em um diretório, sendo assim, podem pertencer a mais de um.
            É importante criar um Tenant para o usuário master com permissões que utilizará a fim de que você não se distraia 
                e faça alguma ação que não gostaria.
            
            Tipos de Tenant:
                1- Azure Active Directory - Padrão
                2- Azure Active Directory (B2C) - Business to Consumer / Onde você se autentica através de aplicativos de mídia social

        Microsoft Identity Platform

            App Registrations
                É utilizado para registrar aplicativos ou até mesmo web api para autenticar usuários através do Azure AD.
                Suporta: OAuth 2.0, OpenID Connect, Graph API, Federation, WS-Federation e SAML-P.

        Microsoft Graph API

            Expõe APIs REST e bibliotecas para acessar dados nos serviços na nuvem da Microsoft
                Ex: 
                    Microsoft 365 core services - Calendar, Excel, OneDrive, SharePoint, Teams, etc...
                    Enterprise Mobility + Security services - Azure Active Directory, Identity Manager, etc...
                    Windows services - Devices, Notifications, etc...
                    Dynamic 365 Business Central
            